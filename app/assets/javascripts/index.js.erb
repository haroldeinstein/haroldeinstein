var loader_interval;
var maxPreloaderWidth;
var pw;
var preloadTime;
var preloadStepTime;
var stepWidth;
var imagesLoaded = 0;

var imageArray = [
  "<%= image_path "commercials_b_off.png" %>",
  "<%= image_path "commercials_b_on.png" %>",
  "<%= image_path "underwear_b_off.png" %>",
  "<%= image_path "underwear_b_on.png" %>",
  "<%= image_path "contact_off.jpg" %>",
  "<%= image_path "contact_on.jpg" %>",
  "<%= image_path "underwear.jpg" %>"]

$(document).ready(function() {

  setTimeout(function() {
    $('#loading-outer').fadeOut(function() {
      $(this).hide();
    });
  }, 500)

  maxPreloaderWidth = $("#loading-inner").width();
  pw = 0;
  preloadTime = 2000;
  preloadStepTime = 10;
  stepWidth = maxPreloaderWidth / (preloadTime / preloadStepTime);

  if ($(window).width() > 400) {
    initPreloader();
  }

});

function initPreloader() {

  for (var i = 0; i < imageArray.length; i++)
  {
    var img = new Image();
    img.src = imageArray[i];
    img.onload = function() { imageLoaded(); }
  }

  setTimeout(function()
  {
    checkForPreload();
  }
  , 500
  );
}

function checkForPreload()
{

  if (imagesLoaded == imageArray.length) skipPreloader(); //if all the images are loaded and we don't need to show the preloader
  else doPreloader();
}

function imageLoaded()
{
  imagesLoaded++;
}

function skipPreloader()
{
  hidePreloader();
  $('#main-outer').hide();
  $('#contact-outer').hide();
  $('#japanese-outer').hide();
  $('#back-outer').hide()
  $('#back-outer').fadeIn(500)
  $('#main-outer').fadeIn(500);
  $('#contact-outer').fadeIn(500);
  $('#japanese-outer').fadeIn(500);
}

function doPreloader()
{
  $('#loading-bar').hide();
  $('#main-outer').hide();
  $('#contact-outer').hide();
  $('#japanese-outer').hide();
  $('#back-outer').hide()
  $('#loading-bar').fadeIn(1000);

  loader_interval = setInterval(function() { animatePreloader() }, 10);
}

function animatePreloader() {

  $('#loading-bar').css('width', pw += stepWidth);
  if(pw >= maxPreloaderWidth) {
    clearInterval(loader_interval);
    $('#loading-bar').fadeOut(500,
      function() {
        hidePreloader();
        $('#main-outer').fadeIn(500);
      }
    );
  }
}

function hidePreloader() {
  $('#loading-outer').hide();
}

function showEmail(){
  $('#contact-inner-text').css('display', 'inline');
}

function hideEmail() {
  $('#contact-inner-text').css('display', 'none');
}
